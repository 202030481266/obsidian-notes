### 什么是曼哈顿距离？

在二维平面上，对于两个点 $(x_1,y_1)$ 和 $(x_2,y_2)$，它们的曼哈顿距离定义为：

$$|x_1-x_2|+|y_1-y_2|$$

这表示从一个点到另一个点沿坐标轴方向移动的总距离。我们的问题是，在给定的一个点集中，找到两个点之间的最大曼哈顿距离。

### 朴素方法的局限性

最直观的方法是检查点集中所有可能的点对，计算每对点的曼哈顿距离，然后取最大值。然而，如果点集有 $n$ 个点，这种方法需要计算 $\binom{n}{2}$ 对距离，时间复杂度为 $O(n^2)$。对于较大的点集，这种方法效率太低，因此我们需要一个更聪明的算法。

### 巧妙算法的思路

经过分析，曼哈顿距离有一个有趣的性质可以帮助我们优化计算。我们发现，对于任意两个点 $P=(x_P,y_P)$ 和 $Q=(x_Q,y_Q)$，它们的曼哈顿距离可以表示为：

$$|x_P-x_Q|+|y_P-y_Q|=\max\left(|(x_P+y_P)-(x_Q+y_Q)|,|(x_P-y_P)-(x_Q-y_Q)|\right)$$

这意味着曼哈顿距离实际上是两种线性组合差值的绝对值的最大值：

- $x+y$ 的差值的绝对值
- $x-y$ 的差值的绝对值

基于这个性质，点集中最大曼哈顿距离一定是以下两者之一：

1. 所有点中 $x+y$ 的最大值与最小值之差
2. 所有点中 $x-y$ 的最大值与最小值之差

也就是说，我们可以通过计算点集中 $x+y$ 和 $x-y$ 的极值来确定最大曼哈顿距离，而无需逐一检查所有点对。

### 算法步骤

基于上述思路，快速求解最大曼哈顿距离的算法如下：
1. **遍历点集，计算线性组合：**
   - 对于每个点 $(x_i,y_i)$，计算 $s_i=x_i+y_i$ 和 $d_i=x_i-y_i$。
2. **找到极值：**
   - 找出所有 $s_i$ 的最大值 $\max(s)$ 和最小值 $\min(s)$。
   - 找出所有 $d_i$ 的最大值 $\max(d)$ 和最小值 $\min(d)$。
3. **计算最大距离：**
   - 计算 $\max(s)-\min(s)$ 和 $\max(d)-\min(d)$。
   - 最大曼哈顿距离为这两者的较大值：

$$\text{最大曼哈顿距离}=\max\left(\left(\max_{i}(x_i+y_i)-\min_{i}(x_i+y_i)\right),\left(\max_{i}(x_i-y_i)-\min_{i}(x_i-y_i)\right)\right)$$

### 时间复杂度

- 遍历点集计算 $x+y$ 和 $x-y$ 需要 $O(n)$ 时间。
- 找到最大值和最小值也只需 $O(n)$ 时间（可以通过一次遍历完成）。
- 最终比较两个差值是 $O(1)$ 操作。
- 因此，总时间复杂度为 $O(n)$，远优于朴素方法的 $O(n^2)$。

### 示例验证

让我们通过一个例子来验证这个算法。假设点集为 $\{(0,0),(1,3),(2,1),(3,2)\}$：

1. **计算 $x+y$ 和 $x-y$：**
   - $(0,0)$：$0+0=0$，$0-0=0$
   - $(1,3)$：$1+3=4$，$1-3=-2$
   - $(2,1)$：$2+1=3$，$2-1=1$
   - $(3,2)$：$3+2=5$，$3-2=1$
2. **找到极值：**
   - $x+y$：$\{0,4,3,5\}$，$\max=5$，$\min=0$
   - $x-y$：$\{0,-2,1,1\}$，$\max=1$，$\min=-2$
3. **计算差值：**
   - $\max(x+y)-\min(x+y)=5-0=5$
   - $\max(x-y)-\min(x-y)=1-(-2)=3$
4. **取最大值：**
   - $\max(5,3)=5$

检查所有点对，最大曼哈顿距离确实是 $(0,0)$ 和 $(3,2)$ 之间的 $|0-3|+|0-2|=5$，与计算结果一致。

再试一个例子 $\{(0,0),(10,10)\}$：
- $(0,0)$：$0+0=0$，$0-0=0$
- $(10,10)$：$10+10=20$，$10-10=0$
- $x+y$：$\{0,20\}$，$20-0=20$
- $x-y$：$\{0,0\}$，$0-0=0$
- $\max(20,0)=20$
- 验证：$|0-10|+|0-10|=20$，正确。

### 为什么这个方法有效？

这个算法的核心在于利用了曼哈顿距离的几何性质。通过考虑 $x+y$ 和 $x-y$ 的极值，我们实际上是在捕捉点集在“对角线方向”上的最大延伸，这些方向对应于曼哈顿距离可能达到的最大值。这种方法避免了逐对计算，而是将问题转化为求一维数组的极差问题。

### 总结

这个巧妙的算法通过以下公式快速求解点集中的最大曼哈顿距离：

$$\max\left(\left(\max_{i}(x_i+y_i)-\min_{i}(x_i+y_i)\right),\left(\max_{i}(x_i-y_i)-\min_{i}(x_i-y_i)\right)\right)$$

它只需要 $O(n)$ 的时间复杂度，非常高效。希望这个解释清晰地解答了您的疑问！如果还有其他问题，欢迎继续提问。
