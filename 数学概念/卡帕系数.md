
### **Cohen's κ 简介**

Cohen's κ是用于衡量两个标注者之间一致性的统计指标，考虑了随机一致的可能性，公式如下：

$$
\kappa = \frac{P_o - P_e}{1 - P_e}
$$

其中：
- $P_o$：实际一致性（标注者之间实际达成一致的比例）。
- $P_e$：期望一致性（在完全随机标注的情况下，标注者达成一致的概率）。

#### **计算步骤**

1. **构建混淆矩阵**：
   - 构建一个$k \times k$的混淆矩阵，行表示标注者A的标注，列表示标注者B的标注，矩阵中的值表示两个标注者在对应类别上的标注次数。

2. **计算实际一致性 $P_o$**：
   实际一致性是两个标注者在标注中达成一致的概率：

   $$
   P_o = \frac{\sum \text{对角线上的值}}{\text{总标注数}}
   $$

3. **计算期望一致性 $P_e$**：
   期望一致性表示随机情况下的标注一致性：

   $$
   P_e = \sum_{i=1}^k \left( \frac{A_i \times B_i}{N^2} \right)
   $$

   其中 $A_i$ 和 $B_i$ 分别是标注者A和B在类别 $i$ 上的标注次数总和，$N$ 是总标注数。

4. **计算Cohen's κ**：
   将$P_o$和$P_e$代入公式，得到$\kappa$值：

   $$
   \kappa = \frac{P_o - P_e}{1 - P_e}
   $$

#### **例子**

假设有两个标注者A和B，他们对5个样本进行了分类，有两个类别。标注的结果如下：

- 标注者A的标注：1，2，2，1，2
- 标注者B的标注：1，2，1，1，2

根据这些标注，构建混淆矩阵：

|     | 类别1 | 类别2 |
| --- | --- | --- |
| 类别1 | 2   | 0   |
| 类别2 | 1   | 2   |

**计算实际一致性 $P_o$**：

$$
P_o = \frac{2 + 2}{5} = 0.8
$$

**计算期望一致性 $P_e$**：

- 标注者A在类别1和类别2上的标注次数分别是2次和3次。
- 标注者B在类别1和类别2上的标注次数分别是3次和2次。

因此，期望一致性为：

$$
P_e = \left( \frac{2 \times 3}{5^2} \right) + \left( \frac{3 \times 2}{5^2} \right) = \frac{6}{25} + \frac{6}{25} = 0.48
$$

**计算Cohen's κ**：

$$
\kappa = \frac{0.8 - 0.48}{1 - 0.48} = \frac{0.32}{0.52} \approx 0.615
$$

Cohen's κ 的值在不同范围内可以解释为不同的一致性水平，常见的解释标准如下：

- **κ < 0**：一致性差，可能比随机还差。
- **0 ≤ κ ≤ 0.20**：轻微一致性。
- **0.21 ≤ κ ≤ 0.40**：较低一致性。
- **0.41 ≤ κ ≤ 0.60**：中等一致性。
- **0.61 ≤ κ ≤ 0.80**：良好一致性。
- **0.81 ≤ κ ≤ 1.00**：几乎完全一致。

这个结果表明两个标注者之间有“良好一致性”。

---

### **加权 Cohen's κ**

加权Cohen's κ用于处理有序类别的标注任务，通过引入权重矩阵，根据类别差异进行惩罚。二次加权的权重定义如下：

$$
w_{ij} = 1 - \left( \frac{(i - j)^2}{(k - 1)^2} \right)
$$

其中 $w_{ij}$ 是类别 $i$ 和类别 $j$ 之间的权重，$k$ 是类别的数量。当两个类别完全一致时，$w_{ij} = 1$；类别差异越大，权重值越小。

#### **计算步骤**

1. **构建权重矩阵**：
   - 使用二次加权公式构建一个$k \times k$的权重矩阵，权重值基于类别之间的距离计算。

2. **计算加权后的实际一致性 $P_o^w$**：
   将实际一致性矩阵中的每个元素与权重矩阵对应元素相乘，然后求和，计算加权后的实际一致性：

   $$
   P_o^w = \frac{\sum w_{ij} \cdot n_{ij}}{N}
   $$

   其中 $n_{ij}$ 是实际一致性矩阵中的值。

3. **计算加权后的期望一致性 $P_e^w$**：
   期望一致性计算方式类似，只不过也需要对权重进行加权处理：

   $$
   P_e^w = \sum w_{ij} \cdot \left( \frac{n_{i \cdot}}{N} \right) \cdot \left( \frac{n_{\cdot j}}{N} \right)
   $$

4. **计算加权Cohen's κ**：
   代入加权后的$P_o^w$和$P_e^w$，得到二次加权Cohen's κ：

   $$
   \kappa_w = \frac{P_o^w - P_e^w}{1 - P_e^w}
   $$

---

### **加权 Cohen's κ 例子**

假设我们有3个类别，标注者A和B的标注如下：

- 标注者A：1，2，3，1，2
- 标注者B：1，1，3，2，2

实际一致性矩阵为：

$$
\text{实际一致性矩阵} = \begin{bmatrix}
1 & 1 & 0 \\
1 & 2 & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

权重矩阵为：

$$
W = \begin{bmatrix}
1 & 0.75 & 0 \\
0.75 & 1 & 0.75 \\
0 & 0.75 & 1
\end{bmatrix}
$$

加权后的实际一致性 $P_o^w$ 和期望一致性 $P_e^w$ 按照上述步骤计算，最后将它们代入公式，得到加权Cohen's κ。

---

### **结论**

Cohen's κ 和加权 Cohen's κ 提供了对标注者一致性的定量评估，尤其适用于处理有序类别的任务。加权Cohen's κ可以根据类别差异进行加权处理，使得较大的分歧受到更大的惩罚。